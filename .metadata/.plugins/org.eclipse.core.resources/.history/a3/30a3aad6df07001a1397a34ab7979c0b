package logica;
import java.util.*;

import javax.swing.JLabel;

import grafica.*;
public class Partida{

	private static Partida INSTANCE;
	private int tiempo;
	private int dificultad;
	private Felix pj;
	private Ralph boss;
	private Jugador player;
	private Edificio tablero;
	private ArrayList<Objeto> objetosPartida;
	private PartidaGUI partidaGUI;
	
	
	private Partida(String nombre) {
		this.tablero = new Edificio(this.dificultad);
		this.tiempo = 900;
		this.dificultad = 1;
		this.pj = new Felix();
		this.boss = new Ralph();
		this.player = new Jugador(nombre);
		this.objetosPartida = new ArrayList<Objeto>();
	}
	
	public static Partida getInstance (String nombre) {
		if (INSTANCE == null) {
			INSTANCE = new Partida(nombre);
			return INSTANCE;
		} else {
			return INSTANCE;
		}
	}
	
	public void inciarGrafica() {
		this.partidaGUI = new PartidaGUI(this.tablero.getVentanas(0), this.tablero.getVentanas(1), this.tablero.getVentanas(2));
	}
	
	public static Partida getInstance() {
		return INSTANCE;
	}

	public void visible() {
		this.partidaGUI.visible();
	}
	
	public void invisible(){
		this.partidaGUI.invisible();
	}
	
	public int getVidas() {
		return this.pj.getVidas();
	}
	
	public boolean puedoSubir() {
		return this.pj.movArriba(this.tablero.getVentanas());
	}
	
	public boolean puedoBajar() {
		return this.pj.movAbajo(this.tablero.getVentanas());
	}
	
	public boolean puedoAvanzar() {
		return this.pj.movDerecha(this.tablero.getVentanas());
	}
	
	public boolean puedoRetroceder() {
		return this.pj.movIzquierda(this.tablero.getVentanas());
	}
	
	public boolean repararVentana() {
		int x = this.pj.repararVentana(this.tablero.getVentanas());
		this.player.setPuntaje(x);
		if (x != 0) {
			return true;
		} else {
			return false;
		}
	}
	
	public void siguienteNivel() {
		this.tablero = new Edificio(Juego.getInstance().proximoNivel());
		partidaGUI.invisible();
		this.partidaGUI = new PartidaGUI(tablero.getVentanas(0), tablero.getVentanas(1), tablero.getVentanas(2));
		this.partidaGUI.visible();
		this.pj.reset();
	}
	
	public void perdiUnaVida() {
		this.tablero = new Edificio(Juego.getInstance().getDificultad());
   		this.partidaGUI.invisible();
		this.partidaGUI = new PartidaGUI(tablero.getVentanas(0), tablero.getVentanas(1), tablero.getVentanas(2));
		this.partidaGUI.visible();
		this.pj.perderVida();
		this.pj.reset();
		this.getJugador().penalizacion();
	}
	
	
	
	
	/** Pregunta si Félix se encuentra con algún elemento de la lista, y de acuerdo al objeto realiza las acciones correspondientes.
	 * Pájaro: reinicia la sección sin perder vidas.
	 * Ladrillo: reinicia el nivel perdiendo una vida.
	 * Torta: Vuelve invulnerable a Félix durante una determinada cantidad de ciclos. **/
	private void gestionarColisiones() {
		if (this.tablero.getVentanas().get(this.pj.getPosFelix().getX()).get(this.pj.getPosFelix().getY()).pajaro()) {
			this.objetosPartida.removeAll(objetosPartida);
			this.tablero.reiniciarEtapa(dificultad);
			this.pj.reset();
			System.out.println("Chocó con un pájaro y se reinició la etapa.");
		} else {
			if (this.tablero.getVentanas().get(this.pj.getPosFelix().getX()).get(this.pj.getPosFelix().getY()).ladrillo()) {
				this.pj.perderVida();
				this.tablero = new Edificio(dificultad);
				this.objetosPartida.removeAll(objetosPartida);
				this.pj.reset();
				System.out.println("Chocó con un ladrillo y se reinicia el nivel.");
			} else {
				if (this.tablero.getVentanas().get(this.pj.getPosFelix().getX()).get(this.pj.getPosFelix().getY()).ladrillo()){
					this.pj.setInvulnerable();
					System.out.println("Félix ahora es invulnerable!");
				}
			}
		}
	}
	
	public Jugador getJugador() {
		return this.player;
	}
	
	public ArrayList<ArrayList<Ventana>>  getVentanas() {
		return this.tablero.getVentanas();
	}
	
	public ArrayList<ArrayList<Ventana>>  getVentanas(int secc) {
		return this.tablero.getVentanas(secc);
	}
	
	public boolean ganeNivel() {
		return this.tablero.nivelTerminado();
	}
	
	public boolean seccionTerminada() {
		if (this.tablero.seccionTerminada()){
			this.tablero.proximaEtapa();
			this.pj.reset();
			return true;
		} else return false;
	}
	
	public int getSeccionActual() {
		return this.tablero.getSeccionActual();
	}
	
	public int getDificultad() {
		return this.dificultad;
	}
	
	public int getTiempo() {
		if (tiempo != 0)
			tiempo--;
		return tiempo;
	}

		
	
	
	
	
	
	
	
	
}
